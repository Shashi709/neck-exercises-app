<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Neck Exercises Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2563eb">
  <meta name="description" content="Comprehensive neck exercises guide with timing and tracking">
  <style>
    html, body {
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #f0f9ff 0%, #f5f3ff 100%);
      margin:0; padding:0;
      min-height: 100%;
      color: #1a1a2e;
      letter-spacing: 0.01em;
    }
    *, *:before, *:after { box-sizing: border-box; }

    h1 {
      text-align:center;
      background: linear-gradient(135deg, #0066ff 0%, #00d4ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin:36px 0 18px 0;
      font-size:2.07em;
      font-weight: 800;
      letter-spacing: 0.05em;
    }

    .container {
      max-width:700px;
      margin:auto;
      padding:18px 10px 32px 10px;
    }

    .section-head {
      margin:38px 0 18px 0;
      font-size:1.14em;
      font-weight: 700;
      color:#fff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      padding: 10px 20px;
      border: none;
      position: relative;
    }

    .exercise-box {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 35px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
      padding: 28px 22px 20px 22px;
      position:relative;
      border: 2px solid #e8e8f5;
      transition: all 0.3s ease;
    }
    .exercise-box.active {
      box-shadow: 0 15px 50px rgba(102, 126, 234, 0.25);
      border-color: #667eea;
      transform: translateY(-2px);
    }

    .ex-header {
      display:flex; align-items:flex-start;
      margin-bottom:13px; gap:16px;
    }
    .ex-icon {
      min-width:56px; min-height:56px;
      width:56px; height:56px;
      background: linear-gradient(135deg, #667eea15, #764ba215);
      border-radius: 12px;
      display:flex; align-items:center; justify-content:center;
      font-size:2.2em; flex-shrink:0; margin-top:2px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
      border: 2px solid #667eea30;
      transition: all 0.2s ease;
    }
    .exercise-box.active .ex-icon {
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.35);
      border-color: #667eea60;
      transform: scale(1.05);
    }

    .ex-content { flex:1;}
    .ex-title {
      font-weight:700;
      font-size:1.10em;
      color:#0066ff;
      margin-bottom:4px;
    }
    .ex-desc {
      color:#555;
      font-size:0.95em;
      margin:5px 0 0 0;
      font-weight:400;
      line-height:1.5;
      letter-spacing:0.005em;
    }

    .inputs-row {
      margin:13px 0 8px 0;
      display:flex;
      gap:16px;
      align-items:stretch;
      flex-wrap:wrap;
    }
    label {
      font-size:0.99em;
      color:#425375;
      font-weight:500;
      display:flex;
      align-items:center;
      gap:6px;
      flex:1;
      min-width:140px;
    }
    input[type='number'] {
      width:100%;
      max-width:70px;
      padding:8px 12px;
      font-size:1em;
      border-radius:7px;
      border:1.5px solid #667eea40;
      background: #f8f9ff;
      color:#0066ff;
      font-weight:600;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.08);
      outline:none;
      transition: all 0.2s ease;
    }
    input[type='number']:focus {
      border:2px solid #667eea;
      background: #fff;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
    }
    input[type='number']:disabled {
      background: #f0f0f5;
      color: #999;
      border-color: #ddd;
    }

    .btn-row {
      display:flex; gap:9px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    button {
      padding:10px 24px;
      font-size:1.03em;
      border-radius:12px;
      border:none;
      font-weight:700;
      cursor:pointer;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color:#fff;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      transition: all 0.2s ease;
    }
    button:hover, button:focus {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: scale(0.95);
    }
    .start {font-weight:800;}
    .pause {background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);}
    .resume {background: linear-gradient(135deg, #10b981 0%, #059669 100%);}
    .reset {background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);}
    button:disabled {
      background: #ccc;
      color: #999;
      cursor: not-allowed;
      box-shadow: none;
    }

    .counter-row {
      display:flex; gap:14px; align-items:center;
      margin:13px 0 2px 0; flex-wrap:wrap;
      font-size:1em;
    }
    .big-num {
      font-size:1.22em;
      color:#0066ff;
      min-width:28px;
      display:inline-block;
      font-weight:700;
    }
    .active .big-num,
    .big-num.pulse {
      color:#3063b1;
    }
    .total-time {
      font-size:0.97em;
      color:#57647d;
      background: #f4f6fa;
      padding: 3px 10px;
      border-radius: 6px;
      font-weight: 600;
      box-shadow: 0 0 7px #dce5f33b;
      border: 1.1px solid #e5eaf4;
      margin-left:4px;
    }

    .progress-txt {
      font-size:1.01em;
      font-weight:600;
      color:#397857;
      margin-top:8px;
      min-height: 16px;
      letter-spacing: 0.01em;
      padding-left: 2px;
    }
    .danger {
      color:#d94343;
      background: #f8f2f2;
      border-radius: 7px;
      padding: 7px 11px 6px 11px;
      font-weight:700;
      box-shadow: 0 0 12px #f2d0d0;
      margin-bottom: 15px;
      display:inline-block;
      border: 1.1px solid #efdddd;
      letter-spacing: 0.03em;
    }
    .warning {color:#ad7b0c;}
    .progress-txt.danger {animation: shake 0.35s 1;}
    .progress-txt.warning {animation: flashWarn 0.5s 1;}

    @keyframes shake {
      20% {transform: translateX(-4px);}
      40% {transform: translateX(5px);}
      60% {transform: translateX(-3px);}
      80% {transform: translateX(2px);}
      100% {transform: translateX(0);}
    }
    @keyframes flashWarn {
      0% {color:#eaaa13;}
      80% {color:#ad7b0c;}
      100% {color:#ad7b0c;}
    }
    .big-num.pulse {
      animation: pulseGrow 0.16s cubic-bezier(.57,.24,.77,1.36);
    }
    @keyframes pulseGrow {
      0% { transform: scale(1);}
      50% { transform: scale(1.15);}
      100% { transform: scale(1);}
    }

    @media (max-width: 900px){
      h1 {font-size: 1.5em; margin:20px 0 12px 0;}
      .container{padding:12px 12px 24px 12px; max-width:100%;}
      .section-head{font-size: 1.05em; padding: 10px 14px; margin:24px 0 14px 0;}
      .exercise-box{padding:16px 14px 14px 14px; margin-bottom:20px; border-radius:16px;}
      .ex-header{gap:12px;}
      .ex-icon{width:48px;min-width:48px;height:48px;min-height:48px;font-size:1.8em; margin-top:0;}
      .ex-title{font-size:1.05em;}
      .ex-desc{font-size:0.95em; line-height:1.45;}
      .inputs-row{gap:10px; margin:12px 0 10px 0;}
      label{font-size:0.95em; min-width:130px;}
      input[type='number']{padding:6px 8px; font-size:0.95em; max-width:65px;}
      .btn-row{gap:7px; margin-top:10px;}
      button{padding:8px 18px; font-size:0.98em; border-radius:9px;}
      .counter-row{gap:10px; margin:12px 0 6px 0; font-size:0.95em;}
      .big-num{font-size:1.15em; min-width:24px;}
      .total-time{font-size:0.92em; padding:2px 8px; border-radius:5px;}
      .theme-toggle{top:8px; right:8px;}
      .theme-toggle button{padding:4px 8px; font-size:0.8em;}
    }
    @media (max-width: 750px){
      .exercise-box{padding:12px 10px 10px 10px; margin-bottom:16px;}
      .ex-header{flex-direction:column; gap:8px;}
      .ex-icon{width:44px; min-width:44px; height:44px; min-height:44px; font-size:1.6em;}
      .ex-title{font-size:1em;}
      .ex-desc{font-size:0.88em;}
      .inputs-row{gap:8px; margin:10px 0 8px 0; flex-direction:column;}
      label{font-size:0.9em; min-width:100%; display:flex; justify-content:space-between; align-items:center;}
      input[type='number']{max-width:100%; padding:7px 10px; font-size:0.9em; flex:0 0 auto; width:70px;}
      .btn-row{gap:5px; margin-top:8px;}
      .btn-row button{font-size:0.88em; padding:6px 12px; flex:1;}
      .counter-row{gap:6px; margin:10px 0 4px 0; font-size:0.86em; flex-wrap:wrap;}
      .big-num{font-size:1.08em; min-width:22px;}
      .total-time{font-size:0.85em; padding:2px 6px;}
      .progress-txt{font-size:0.92em; margin-top:5px;}
    }
    @media (max-width: 600px){
      h1 {font-size: 1.25em; margin:16px 0 10px 0;}
      .container{padding:10px 10px 18px 10px;}
      .section-head{font-size: 0.95em; padding: 8px 12px; margin:18px 0 12px 0;}
      .exercise-box{padding:10px 9px 8px 9px; margin-bottom:14px; border-radius:12px;}
      .ex-icon{width:40px; min-width:40px; height:40px; min-height:40px; font-size:1.5em;}
      .ex-title{font-size:0.98em;}
      .ex-desc{font-size:0.85em; line-height:1.35;}
      .inputs-row{gap:6px; margin:8px 0 6px 0; flex-direction:column;}
      label{font-size:0.88em; justify-content:space-between; min-width:100%;}
      input[type='number']{width:65px; padding:6px 8px; font-size:0.88em;}
      .btn-row{gap:4px; margin-top:6px;}
      .btn-row button{font-size:0.84em; padding:5px 10px; flex:1; min-height:32px;}
      .counter-row{gap:5px; margin:8px 0 3px 0; font-size:0.82em; flex-wrap:wrap;}
      .big-num{font-size:1.05em; min-width:20px;}
      .total-time{font-size:0.8em; padding:1px 5px;}
      .progress-txt{font-size:0.88em; margin-top:4px;}
      .danger{padding:5px 8px 4px 8px; font-size:0.85em; margin-bottom:10px;}
      .theme-toggle{top:5px; right:5px; gap:4px;}
      .theme-toggle button{padding:3px 6px; font-size:0.72em; border-radius:5px;}
    }
    @media (max-width: 480px){
      html, body{font-size:13px;}
      h1 {font-size: 1.1em; margin:12px 0 8px 0;}
      .container{padding:8px 8px 14px 8px;}
      .section-head{font-size: 0.88em; padding: 6px 10px; margin:14px 0 10px 0; border-radius:9px;}
      .exercise-box{padding:8px 8px 6px 8px; margin-bottom:12px; border-radius:10px;}
      .ex-header{gap:8px;}
      .ex-icon{width:36px; min-width:36px; height:36px; min-height:36px; font-size:1.3em;}
      .ex-title{font-size:0.95em; font-weight:700;}
      .ex-desc{font-size:0.82em; line-height:1.32; margin:2px 0 0 0;}
      .inputs-row{gap:5px; margin:6px 0 4px 0; flex-direction:column;}
      label{font-size:0.85em; font-weight:500; justify-content:space-between; gap:4px;}
      input[type='number']{width:60px; padding:5px 7px; font-size:0.85em; border-radius:5px;}
      input[type='number']:disabled {background: #f3f6fb; color: #a5aab3; border-color: #ebf0f8; }
      .btn-row{gap:3px; margin-top:5px; flex-wrap:wrap;}
      .btn-row button{font-size:0.8em; padding:4px 8px; border-radius:6px; flex:1; min-width:60px; min-height:30px;}
      .counter-row{gap:4px; margin:6px 0 2px 0; font-size:0.78em; flex-wrap:wrap;}
      .big-num{font-size:1.02em; min-width:18px;}
      .total-time{font-size:0.76em; padding:1px 4px; border-radius:3px; margin-left:2px;}
      .progress-txt{font-size:0.84em; margin-top:3px; min-height:13px;}
      .danger{padding:4px 6px 3px 6px; font-size:0.78em; border-radius:4px; margin-bottom:8px;}
      .warning{font-size:0.84em;}
      .theme-toggle{top:4px; right:4px; gap:2px;}
      .theme-toggle button{padding:2px 5px; font-size:0.65em; border-radius:4px; border:1px solid #999;}
    }
    @media (max-width: 380px){
      h1 {font-size: 1em; margin:10px 0 6px 0;}
      .container{padding:6px 6px 10px 6px;}
      .section-head{font-size: 0.82em; padding: 5px 8px; margin:10px 0 8px 0; border-radius:8px;}
      .exercise-box{padding:6px 6px 4px 6px; margin-bottom:10px; border-radius:8px;}
      .ex-header{gap:6px;}
      .ex-icon{width:32px; min-width:32px; height:32px; min-height:32px; font-size:1.1em;}
      .ex-title{font-size:0.9em; margin-bottom:2px;}
      .ex-desc{font-size:0.78em; line-height:1.3; margin:1px 0 0 0;}
      .inputs-row{gap:4px; margin:5px 0 3px 0;}
      label{font-size:0.8em; justify-content:space-between;}
      input[type='number']{width:55px; padding:4px 6px; font-size:0.8em; border-radius:4px;}
      .btn-row{gap:2px; margin-top:4px;}
      .btn-row button{font-size:0.75em; padding:3px 6px; min-width:50px; min-height:28px;}
      .counter-row{gap:3px; margin:5px 0 1px 0; font-size:0.74em;}
      .big-num{font-size:0.98em; min-width:16px;}
      .total-time{font-size:0.72em; padding:0px 3px; margin-left:1px;}
      .progress-txt{font-size:0.8em; margin-top:2px; min-height:12px;}
      .danger{padding:3px 5px; font-size:0.74em; margin-bottom:6px;}
      .theme-toggle{top:3px; right:3px; gap:2px;}
      .theme-toggle button{padding:2px 4px; font-size:0.6em; border-radius:3px;}
    }
    /* Dark mode overrides */
    body.dark-mode {
      background: linear-gradient(135deg, #0a1118 0%, #1a0f2e 100%);
      color: #e0e8ff;
    }
    body.dark-mode .section-head{
      background: linear-gradient(135deg, #4c3899 0%, #6b2e9f 100%);
      color: #fff;
      border: none;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.25);
    }
    body.dark-mode .exercise-box{
      background: #0f1820;
      border-color: #667eea40;
      box-shadow: 0 10px 35px rgba(0, 0, 0, 0.3);
      color: #e0e8ff;
    }
    body.dark-mode .ex-icon{ background: linear-gradient(135deg, #667eea15, #764ba215); border-color: #667eea40; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15); }
    body.dark-mode input[type='number']{ background:#0a0f1a; color:#6ba3ff; border-color:#667eea40; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1); }
    body.dark-mode button{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; border: none; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
    body.dark-mode .total-time{ background:#0a0f1a; color:#8ebfff; border-color:#667eea40; }
    body.dark-mode .progress-txt{ color:#80d8ff; }
    body.dark-mode .danger{ background:#3b1212; color:#ffd6d6; border-color:#5a1b1b; box-shadow:none; }
    .theme-toggle{ position:fixed; top:10px; right:10px; z-index:999; display:flex; gap:6px; }
    .theme-toggle button{ padding:5px 10px; border-radius:7px; font-weight:600; cursor:pointer; font-size:0.85em; }
  </style>
</head>
<body>
  <h1>Neck Exercises Guide</h1>
  <div class="theme-toggle">
    <button id="themeToggle" aria-pressed="false" title="Toggle dark mode">üåô</button>
    <button id="adminBtn" title="Go to Admin Panel" style="background:#2563eb; color:#fff;">‚öôÔ∏è</button>
  </div>
  <div class="container" id="exerciseContainer">
    <div style="margin:16px 0 12px 0; text-align:center;">
      <span class="danger">If you experience any pain, STOP exercising immediately!</span>
    </div>
  </div>
  <!-- Use Google beep sound for max compatibility -->
  <audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<script>
// --- Register Service Worker for offline caching ---
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js').then(() => {
    console.log('Service Worker registered successfully');
  }).catch((error) => {
    console.log('Service Worker registration failed:', error);
  });
}

// --- Theme toggle (dark mode) ---
(function(){
  const themeToggle = document.getElementById('themeToggle');
  function applyTheme(t){
    if(t==='dark'){
      document.body.classList.add('dark-mode');
      themeToggle.setAttribute('aria-pressed','true');
      themeToggle.textContent = '‚òÄÔ∏è';
    } else {
      document.body.classList.remove('dark-mode');
      themeToggle.setAttribute('aria-pressed','false');
      themeToggle.textContent = 'üåô';
    }
  }
  if(themeToggle){
    themeToggle.addEventListener('click', ()=>{
      const next = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
      applyTheme(next);
      try{ localStorage.setItem('neck_theme', next); }catch(e){}
    });
    // Initialize: stored preference -> system preference -> light
    const stored = (()=>{ try{return localStorage.getItem('neck_theme')}catch(e){return null} })();
    if(stored) applyTheme(stored);
    else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) applyTheme('dark');
    else applyTheme('light');
  }
})();

document.getElementById('adminBtn').addEventListener('click', ()=>{
  window.location.href = 'admin.html';
});

const exerciseSections = [
  {
    title: "Warm-up Exercises",
    exercises: [
      {
        name: "Neck Rotation",
        icon: "üîÑ",
        description: "Slowly turn your head left and right. Don't force, stay gentle.",
        defaultReps: 20, defaultSeconds: 12
      },
      {
        name: "Neck Side Bending",
        icon: "‚ÜîÔ∏è",
        description: "Slowly bend your head so your ear moves towards shoulder (left/right). Shoulders relaxed.",
        defaultReps: 20, defaultSeconds: 12
      }
    ]
  },
  {
    title: "Strengthening Exercises",
    exercises: [
      {
        name: "Front + Back Neck Isometric",
        icon: "üßë‚Äçü¶±‚úã‚ÜîÔ∏è",
        description: "Alternate: Push forehead into hands (front), then push back of head into hands (back), hold. 1 rep = front + back.",
        defaultReps: 20, defaultSeconds: 12
      },
      {
        name: "Side Neck Isometric (Left + Right)",
        icon: "<span>üßëü§ö</span><span style='margin-left:-6px;'>ü§öüßë</span>",
        description: "Place hand on left side of head. Push head against hand (no movement), then switch to right side. <br>1 rep = both sides.",
        defaultReps: 20, defaultSeconds: 12
      },
      {
        name: "Shoulder Shrugs",
        icon: "ü§∑",
        description: "Move your shoulders up towards your ears, then relax to original position.",
        defaultReps: 20, defaultSeconds: 12
      },
      {
        name: "Arm Swinging",
        icon: "üí™‚ÜîÔ∏è",
        description: "Move your arms forward and backward as shown (see picture/guide if unsure).",
        defaultReps: 8, defaultSeconds: 10
      }
    ]
  }
];

// --- Beep logic ---
const beep = document.getElementById('beep-sound');

// Unlock audio on first interaction
let audioUnlocked = false;
function unlockAudio() {
  if (!audioUnlocked) {
    beep.muted = true;
    beep.play().catch(()=>{});
    setTimeout(() => {
      beep.pause(); beep.currentTime=0;
      beep.muted = false;
    }, 100);
    audioUnlocked = true;
  }
}
window.addEventListener('mousedown', unlockAudio, {once:true});
window.addEventListener('touchstart', unlockAudio, {once:true});

function playBeep(repeats) {
  let played = 0;
  const interval = setInterval(() => {
    beep.currentTime = 0;
    beep.play();
    played++;
    if (played >= repeats) clearInterval(interval);
  }, 250);
}

// --- UI rendering and timer logic ---
function formatTime(secs) {
  let m = Math.floor(secs/60), s = secs%60;
  return `${m}:${s<10?'0':''}${s}`;
}

const exContainer = document.getElementById('exerciseContainer');
exerciseSections.forEach((sec, secIdx) => {
  const sectionHead = document.createElement('div');
  sectionHead.className = "section-head";
  sectionHead.textContent = sec.title;
  exContainer.appendChild(sectionHead);

  sec.exercises.forEach((ex, idx) => {
    const exBox = document.createElement('div');
    exBox.className = "exercise-box";
    let iconHTML = ex.icon.startsWith('<span') ? ex.icon : `<span>${ex.icon}</span>`;
    exBox.innerHTML = `
      <div class="ex-header">
        <div class="ex-icon">${iconHTML}</div>
        <div class="ex-content">
          <div class="ex-title">${ex.name}</div>
          <div class="ex-desc">${ex.description}</div>
        </div>
      </div>
      <div class="inputs-row">
        <label>Reps:
          <input type="number" min="1" max="99" value="${ex.defaultReps}" id="reps_${secIdx}_${idx}">
        </label>
        <label>Time/Rep (sec):
          <input type="number" min="1" max="99" value="${ex.defaultSeconds}" id="seconds_${secIdx}_${idx}">
        </label>
      </div>
      <div class="btn-row">
        <button class="start"    id="start_${secIdx}_${idx}">Start</button>
        <button class="pause"    id="pause_${secIdx}_${idx}" style="display:none;">Pause</button>
        <button class="resume"   id="resume_${secIdx}_${idx}" style="display:none;">Resume</button>
        <button class="reset"    id="reset_${secIdx}_${idx}"  style="display:none;">Reset</button>
      </div>
      <div class="counter-row">
        <span>Rep: <span class="big-num" id="currRep_${secIdx}_${idx}">0</span>/<span id="maxRep_${secIdx}_${idx}">${ex.defaultReps}</span></span>
        <span>Time: <span class="big-num" id="currSec_${secIdx}_${idx}">0</span>/<span id="maxSec_${secIdx}_${idx}">${ex.defaultSeconds}</span> sec</span>
        <span class="total-time">Total: <span id="totalTime_${secIdx}_${idx}">0:00</span></span>
      </div>
      <div class="progress-txt" id="progressTxt_${secIdx}_${idx}">&nbsp;</div>
    `;
    exContainer.appendChild(exBox);

    let state = {
      running: false, paused: false, finished: false,
      rep: 0, sec: 0, total: 0, interval: null,
      reps: ex.defaultReps, perSec: ex.defaultSeconds,
    };

    const repInp = document.getElementById(`reps_${secIdx}_${idx}`);
    const secInp = document.getElementById(`seconds_${secIdx}_${idx}`);
    const startBtn = document.getElementById(`start_${secIdx}_${idx}`);
    const pauseBtn = document.getElementById(`pause_${secIdx}_${idx}`);
    const resumeBtn = document.getElementById(`resume_${secIdx}_${idx}`);
    const resetBtn = document.getElementById(`reset_${secIdx}_${idx}`);
    const currRep = document.getElementById(`currRep_${secIdx}_${idx}`);
    const maxRep = document.getElementById(`maxRep_${secIdx}_${idx}`);
    const currSec = document.getElementById(`currSec_${secIdx}_${idx}`);
    const maxSec = document.getElementById(`maxSec_${secIdx}_${idx}`);
    const totalTime = document.getElementById(`totalTime_${secIdx}_${idx}`);
    const progressTxt = document.getElementById(`progressTxt_${secIdx}_${idx}`);

    function updateDisplay() {
      currRep.innerText = state.rep;
      maxRep.innerText = state.reps;
      currSec.innerText = state.sec;
      maxSec.innerText = state.perSec;
      totalTime.innerText = formatTime(state.total);
      if(state.finished) {
        progressTxt.innerText = "WELL DONE! Exercise complete.";
        progressTxt.className = "progress-txt danger";
        exBox.classList.remove("active");
      }
      else if(state.rep>=state.reps) {
        progressTxt.innerText = "Completed! Press Reset to repeat.";
        progressTxt.className = "progress-txt warning";
        exBox.classList.remove("active");
      }
      else if(state.running) {
        let left = state.reps - state.rep;
        progressTxt.innerText = left==0 ? "Last rep!" : (left==1 ? "Last one, keep going!" : `Only ${left} left!`);
        progressTxt.className = "progress-txt";
        exBox.classList.add("active");
      } else if(state.paused) {
        progressTxt.innerText = "Paused";
        progressTxt.className = "progress-txt warning";
      } else {
        progressTxt.innerHTML = "&nbsp;";
        progressTxt.className = "progress-txt";
        exBox.classList.remove("active");
      }
    }
    function disableInputs(dis) {
      repInp.disabled = dis;
      secInp.disabled = dis;
    }
    function start() {
      state.reps = parseInt(repInp.value)||1;
      state.perSec = parseInt(secInp.value)||1;
      state.rep = 0; state.sec = 0; state.total=0;
      state.running=true; state.paused=false; state.finished=false;
      disableInputs(true);
      currRep.classList.remove('pulse');
      currSec.classList.remove('pulse');
      updateDisplay();
      startBtn.style.display='none';
      pauseBtn.style.display='';
      resumeBtn.style.display='none';
      resetBtn.style.display='';
      exBox.classList.add("active");
      state.interval = setInterval(() => {
        if(state.paused||state.finished) return;
        state.sec++; state.total++;
        currSec.classList.add('pulse');
        setTimeout(()=>currSec.classList.remove('pulse'),220);
        if(state.sec>=state.perSec) {
          state.sec=0;
          state.rep++;
          currRep.classList.add('pulse');
          setTimeout(()=>currRep.classList.remove('pulse'),200);
          playBeep(2);
          if(state.rep>=state.reps) {
            clearInterval(state.interval); state.interval=null;
            state.running=false; state.finished=true;
            setTimeout(()=>playBeep(7), 350);
          }
        }
        updateDisplay();
      },1000);
    }
    function pause() {
      if(state.running && !state.paused){
        state.paused=true; state.running=false;
        clearInterval(state.interval); state.interval=null;
        pauseBtn.style.display='none'; resumeBtn.style.display='';
        exBox.classList.remove("active");
        updateDisplay();
      }
    }
    function resume() {
      if(state.paused && !state.running){
        state.paused=false; state.running=true;
        pauseBtn.style.display=''; resumeBtn.style.display='none';
        exBox.classList.add("active");
        state.interval = setInterval(() => {
          if(state.paused||state.finished) return;
          state.sec++; state.total++;
          currSec.classList.add('pulse');
          setTimeout(()=>currSec.classList.remove('pulse'),220);
          if(state.sec>=state.perSec) {
            state.sec=0; state.rep++;
            currRep.classList.add('pulse');
            setTimeout(()=>currRep.classList.remove('pulse'),200);
            playBeep(2);
            if(state.rep>=state.reps) {
              clearInterval(state.interval); state.interval=null;
              state.running=false; state.finished=true;
              setTimeout(()=>playBeep(7),350);
            }
          }
          updateDisplay();
        },1000);
        updateDisplay();
      }
    }
    function reset() {
      if(state.interval) {clearInterval(state.interval);}
      state.rep=0; state.sec=0; state.total=0;
      state.running=false; state.paused=false; state.finished=false;
      updateDisplay();
      startBtn.style.display=''; pauseBtn.style.display='none'; resumeBtn.style.display='none'; resetBtn.style.display='none';
      disableInputs(false);
      exBox.classList.remove("active");
    }
    startBtn.onclick = start;
    pauseBtn.onclick = pause;
    resumeBtn.onclick = resume;
    resetBtn.onclick = reset;
    repInp.addEventListener('change', reset);
    secInp.addEventListener('change', reset);
    updateDisplay(); pauseBtn.style.display='none'; resumeBtn.style.display='none'; resetBtn.style.display='none';
  });
});
</script>
</body>
</html>
